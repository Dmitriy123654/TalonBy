<div class="datetime-selection-page">
  <!-- Мобильное меню -->
  <div class="mobile-details" *ngIf="isMobile">
    <div class="mobile-header" (click)="toggleDetails()">
      <h1>{{hospital?.name}}</h1>
      <span class="toggle-btn">
        {{isDetailsOpen ? '‹ Скрыть' : 'Показать подробнее ›'}}
      </span>
    </div>

    <div class="mobile-content" [class.open]="isDetailsOpen">
      <div class="info-grid">
        <div class="address-block">
          <p>{{hospital?.address}}</p>
          <a href="#" class="map-link">показать на карте</a>
        </div>
        <div class="registry-block">
          <div class="phones">
            <ng-container *ngFor="let item of getPhones()">
              <span *ngIf="item.isLabel" class="label">{{item.text}}</span>
              <a *ngIf="!item.isLabel" href="tel:{{item.text}}">{{item.text}}</a>
            </ng-container>
          </div>
        </div>
        <div class="schedule-block">
          <div class="schedule-row">
            <span class="label">ПН-ПТ:</span>{{getWorkingHours('ПН-ПТ')}}
          </div>
          <div class="schedule-row">
            <span class="label">СБ:</span>{{getWorkingHours('СБ')}}
          </div>
        </div>
        <div class="contacts-block">
          <a *ngIf="hospital?.website" href="{{hospital?.website}}" class="website">{{getDomain(hospital?.website)}}</a>
          <a *ngIf="hospital?.email" href="mailto:{{hospital?.email}}" class="email">{{hospital?.email}}</a>
        </div>
      </div>
    </div>

    <div class="order-steps-mobile" *ngIf="isMobile">
      <div class="order-steps">
        <div class="step completed" (click)="goToSpeciality()">
          Специальность
          <span class="substep">{{speciality?.name}}</span>
        </div>
        <div class="step completed" (click)="goToDoctor()">
          Врач
          <span class="substep">{{doctor?.fullName}}</span>
        </div>
        <div class="step active">Дата и время</div>
        <div class="step">Личные данные</div>
        <div class="step">Запись</div>
      </div>
    </div>
  </div>

  <!-- Десктопная версия -->
  <div class="hospital-header">
    <div class="wrapper">
      <div class="hospital-info">
        <h1>{{hospital?.name}}</h1>
        <div class="info-grid">
          <div class="address-block">
            <p>{{hospital?.address}}</p>
            <a href="#" class="map-link">показать на карте</a>
          </div>
          <div class="registry-block">
            <div class="phones">
              <ng-container *ngFor="let item of getPhones()">
                <span *ngIf="item.isLabel" class="label">{{item.text}}</span>
                <a *ngIf="!item.isLabel" href="tel:{{item.text}}">{{item.text}}</a>
              </ng-container>
            </div>
          </div>
          <div class="schedule-block">
            <div class="schedule-row">
              <span class="label">ПН-ПТ:</span>{{getWorkingHours('ПН-ПТ')}}
            </div>
            <div class="schedule-row">
              <span class="label">СБ:</span>{{getWorkingHours('СБ')}}
            </div>
          </div>
          <div class="contacts-block">
            <a *ngIf="hospital?.website" href="{{hospital?.website}}" class="website">{{getDomain(hospital?.website)}}</a>
            <a *ngIf="hospital?.email" href="mailto:{{hospital?.email}}" class="email">{{hospital?.email}}</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  

  <div class="wrapper">
    <div class="content-block">
      <aside>
        <div class="order-steps">
          <div class="step completed" (click)="goToSpeciality()">
            Специальность
            <span class="substep">{{speciality?.name}}</span>
          </div>
          <div class="step completed" (click)="goToDoctor()">
            Врач
            <span class="substep">{{doctor?.fullName}}</span>
          </div>
          <div class="step active">Дата и время</div>
          <div class="step">Личные данные</div>
          <div class="step">Запись</div>
        </div>

        <nav class="hospital-nav">
          <ul>
            <li><a href="#">Информация</a></li>
            <li><a href="#">Врачи</a></li>
            <li><a href="#">Расписание врачей</a></li>
          </ul>
        </nav>
      </aside>

      <main>
        <h2>Заказ талона</h2>
        <p class="subtitle">Выбор даты и времени</p>

        <div class="calendar-wrapper">
          <div class="calendar-header">
            <button class="month-nav" 
                    (click)="prevMonth()" 
                    [disabled]="!canGoToPrevMonth()"
                    [class.disabled]="!canGoToPrevMonth()">&lt;</button>
            <h3>{{ months[currentMonth.getMonth()] }} {{ currentMonth.getFullYear() }}</h3>
            <button class="month-nav" 
                    (click)="nextMonth()" 
                    [disabled]="!canGoToNextMonth()"
                    [class.disabled]="!canGoToNextMonth()">&gt;</button>
          </div>

          <!-- Индикатор загрузки для календаря -->
          <div class="loading-indicator" *ngIf="loading && !selectedDate">
            <span>Загрузка расписания...</span>
          </div>

          <!-- Сообщение об ошибке -->
          <div class="error-message" *ngIf="error">
            <p>{{ error }}</p>
          </div>

          <div class="calendar">
            <div class="weekdays">
              <div class="weekday" *ngFor="let day of weekDays">{{day}}</div>
            </div>
            
            <div class="calendar-grid">
              <div class="week" *ngFor="let week of calendar">
                <div class="day" *ngFor="let day of week" 
                     [class.weekend]="day.isWeekend"
                     [class.disabled]="day.isDisabled || day.availableSlots === 0"
                     [class.today]="day.isToday"
                     [class.selected]="selectedDate && day.date === selectedDate.getDate() && 
                                    day.month === selectedDate.getMonth() && 
                                    day.year === selectedDate.getFullYear()"
                     [class.has-slots]="day.availableSlots > 0"
                     (click)="selectDate(day)">
                  <span class="date">{{day.date || ''}}</span>
                  <span class="slots" *ngIf="day.date && !day.isDisabled && day.availableSlots > 0">
                    {{day.availableSlots}}
                  </span>
                </div>
              </div>

              <div class="time-slots-row" *ngIf="selectedDate" [@slideInOut]>
                <div class="selected-date">
                  {{ selectedDate | date:'d MMMM' }}, {{ getDayOfWeek(selectedDate) }}
                </div>
                
                <!-- Индикатор загрузки для временных слотов -->
                <div class="loading-indicator" *ngIf="loading && selectedDate">
                  <span>Загрузка доступных слотов...</span>
                </div>
                
                <!-- Сообщение об отсутствии слотов -->
                <div class="no-slots-message" *ngIf="!loading && availableTimeSlots.length === 0 && selectedDate">
                  <p>На выбранную дату нет доступных слотов</p>
                </div>
                
                <div class="time-slots" *ngIf="!loading && availableTimeSlots.length > 0">
                  <button class="time-slot" *ngFor="let slot of availableTimeSlots" (click)="selectTimeSlot(slot)">
                    {{ slot.startTime }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
</div>
